<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Permissions-Policy" content="interest-cohort=()">

  <title>Affordable Wire Management - Hazard Tool</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="awm-header">
    <img src="logo.png" alt="AWM Logo" class="awm-logo" />
    <div class="header-text">
      <h1>Affordable Wire Management</h1>
      <h2>Hazard Data Tool</h2>
    </div>
  </header>

  <main class="tool-container">
    <!-- Instructions Section -->
    <section class="instructions">
      <h3>Instructions</h3>
      <p>1. Download the CSV template using the button below.</p>
      <p>2. Fill in all required fields (Latitude, Longitude, Standards Version, Risk Level, Site Class).</p>
      <p>3. Upload the completed CSV file and click 'Process'.</p>
      <p>4. Review results and download the output with hazard data.</p>
      <p>5. Errors, if any, will be shown below with details for correction.</p>
      <button id="downloadTemplateButton">Download Template</button>

        <script>
          // Debugging - Log if the script is running
          console.log('Script loaded successfully');

          // Add event listener to the button
          document.getElementById('downloadTemplateButton').addEventListener('click', function () {
            console.log('Button clicked!'); // Debugging

            // CSV content
            const csvContent = [
              ['Latitude', 'Longitude', 'Standards Version', 'Risk Level', 'Site Class'],
              ['34.0522', '-118.2437', '7-22', '2', 'D'],
              ['40.7128', '-74.0060', '7-16', '3', 'B-estimated'],
              ['37.7749', '-122.4194', '41-17', '1', 'F'],
              ['29.7604', '-95.3698', '7-10', '4', 'A']
            ];

            // Create CSV string
            let csvString = csvContent.map(e => e.join(",")).join("\n");

            // Create Blob and trigger download
            const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', 'AWM-Hazard-Tool-Template.csv');
            document.body.appendChild(link); // Required for Firefox
            link.click();
            document.body.removeChild(link);

            console.log('Download should start now'); // Debugging
          });
        </script>

      <!-- Instructional Note -->
      <div class="instructions-note">
        <p><strong>Important:</strong> When opening the template in Excel, ensure that columns for "Standards Version" and other values are treated as <strong>text</strong> to avoid automatic formatting (e.g., dates).</p>
        <p>To do this, import the CSV into Excel and set the data type for these columns as <strong>Text</strong> during import.</p>
        <p>Alternatively, use a plain text editor (e.g., Notepad) to edit the template without formatting issues.</p>
      </div>
    </section>

    <!-- Upload Section -->
    <section class="upload-section">
      <h3>Upload CSV File</h3>
      <label for="csvFile">Choose CSV File:</label>
      <input type="file" id="csvFile" accept=".csv" />
      <div class="upload-controls">
        <button id="processButton" disabled>Process</button>
        <button id="downloadButton" disabled>Download CSV</button>
      </div>
    </section>

    <!-- Error Messages Section -->
    <section id="errorMessages" class="error-messages"></section>

    <!-- Output Table Section -->
    <section class="output-section">
      <table id="outputTable" style="display: none;">
        <thead>
          <tr>
            <th>Latitude</th>
            <th>Longitude</th>
            <th>Standards</th>
            <th>Risk Level</th>
            <th>Site Class</th>
            <th>Seismic</th>
            <th>Wind</th>
            <th>Snow</th>
            <th>Ice</th>
            <th>Rain</th>
            <th>Flood</th>
            <th>Tsunami</th>
            <th>Tornado</th>
            <th>Response Code</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <footer class="awm-footer">
    <p>Developed by Fritz for Affordable Wire Management &copy; 2025</p>
  </footer>

  <script src="validation.js"></script>
  <script src="main.js"></script>
</body>
</html>
